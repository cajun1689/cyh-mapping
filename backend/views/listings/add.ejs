<div class="ui segment" style="max-width: 800px; margin: 2em auto; padding: 2em;">
  <header style="text-align: center; margin-bottom: 1.5em;">
    <h1 class="ui header dark-teal-text">
      <i class="ui icon plus circle"></i>
      <div class="content">
        Add a Listing
        <div class="sub header">Manually add a single resource to the map</div>
      </div>
    </h1>
  </header>

  <% if (props.success) { %>
  <div class="ui success icon message">
    <i class="large check middle aligned icon"></i>
    <div class="content">
      <div class="header">Listing Added</div>
      <p>"<%= props.addedName %>" has been added to the map.</p>
    </div>
  </div>
  <% } %>

  <% if (props.error) { %>
  <div class="ui negative message">
    <div class="header">Error</div>
    <p><%= props.error %></p>
  </div>
  <% } %>

  <form class="ui form" action="/listings/add" method="POST">

    <h3 class="ui dividing header">Required</h3>

    <div class="required field">
      <label>Resource Name</label>
      <input type="text" name="full_name" placeholder="e.g. Central Wyoming Counseling Center" required>
    </div>

    <div class="required field">
      <label>Category</label>
      <select class="ui dropdown" name="category" required>
        <option value="">-- Select a category --</option>
        <% if (props.categories) { %>
          <% props.categories.forEach(function(cat) { %>
            <option value="<%= cat %>"><%= cat %></option>
          <% }) %>
        <% } %>
        <option value="__custom">+ Add new category...</option>
      </select>
    </div>

    <div class="field" id="custom-category-field" style="display: none;">
      <label>New Category (format: "Parent: Subcategory")</label>
      <input type="text" name="custom_category" placeholder="e.g. Education: After School Programs">
    </div>

    <div class="required field">
      <label>Description</label>
      <textarea name="description" rows="3" placeholder="Brief description of the resource and services offered" required></textarea>
    </div>

    <h3 class="ui dividing header">Contact Info</h3>

    <div class="two fields">
      <div class="field">
        <label>Phone</label>
        <input type="text" name="phone_1" placeholder="307-xxx-xxxx">
      </div>
      <div class="field">
        <label>Crisis Line</label>
        <input type="text" name="crisis_line_number" placeholder="If applicable">
      </div>
    </div>

    <div class="two fields">
      <div class="field">
        <label>Website</label>
        <input type="url" name="website" placeholder="https://example.org">
      </div>
      <div class="field">
        <label>Email</label>
        <input type="email" name="program_email" placeholder="contact@example.org">
      </div>
    </div>

    <h3 class="ui dividing header">Location</h3>

    <div class="field">
      <label>Organization / Location Name</label>
      <input type="text" name="parent_organization" placeholder="e.g. Community Health Center">
    </div>

    <div class="field">
      <label>Full Address</label>
      <input type="text" name="full_address" placeholder="123 Main St, Casper, WY 82601">
    </div>

    <div class="two fields">
      <div class="field">
        <label>City</label>
        <input type="text" name="city" value="Casper">
      </div>
      <div class="field">
        <label>Service Type</label>
        <select class="ui dropdown" name="service_type">
          <option value="In-Person">In-Person</option>
          <option value="Online Only">Online Only</option>
          <option value="In-Person,Telehealth">In-Person + Telehealth</option>
          <option value="Telehealth">Telehealth Only</option>
        </select>
      </div>
    </div>

    <h3 class="ui dividing header">Details</h3>

    <div class="two fields">
      <div class="field">
        <label>Min Age</label>
        <input type="number" name="min_age" value="11" min="0" max="99">
      </div>
      <div class="field">
        <label>Max Age</label>
        <input type="number" name="max_age" value="20" min="0" max="99">
      </div>
    </div>

    <div class="field">
      <label>Eligibility Requirements</label>
      <input type="text" name="eligibility_requirements" placeholder="e.g. Must be under 18, Medicaid accepted">
    </div>

    <div class="field">
      <label>Cost / Financial Info</label>
      <input type="text" name="financial_information" placeholder="e.g. Free, Sliding scale, Medicaid accepted">
    </div>

    <div class="field">
      <label>Languages Offered (comma separated)</label>
      <input type="text" name="languages_offered" placeholder="e.g. English, Spanish">
    </div>

    <div class="field">
      <label>Next Steps / Intake Instructions</label>
      <textarea name="intake_instructions" rows="2" placeholder="e.g. Call to schedule an appointment"></textarea>
    </div>

    <div class="ui divider"></div>

    <button type="submit" class="ui button fluid teal-background" style="font-size: 1.1em;">
      <i class="plus icon"></i> Add Listing
    </button>
  </form>
</div>

<script>
  document.querySelector('select[name="category"]').addEventListener('change', function() {
    var customField = document.getElementById('custom-category-field');
    customField.style.display = this.value === '__custom' ? 'block' : 'none';
  });
</script>
