@import url('https://fonts.googleapis.com/css2?family=Yanone+Kaffeesatz&display=swap');

#map-nav { scroll-snap-align: start; background-color: #1B3A5C !important; }
#map-nav > form > .labels { padding: 0; margin: 0; }
#map-nav > form > .labels > .label { text-transform: capitalize; }

.leaflet-container { height: 68vh; }

#map-page { display: grid; grid: 'cards map-right' / 1fr 1fr; gap: 1em; }
#map-page > .cards { grid-area: cards; width: auto; margin-top: 1rem; }
#map-page > .cards > .card:first-child { margin-top: 0; }
#map-page > .cards > .card { scroll-snap-align: start; }
#map-page > .map-right-col { grid-area: map-right; position: sticky; top: 72px; z-index: 1; align-self: start; }
#map-page > .map-right-col > .leaflet-container { width: auto; }
#map-page .leaflet-popup-content .description { display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; }

#map-page nav.filters { position: sticky; top: 58px; z-index: 2; }
#map-page > nav > .ui.form .field { margin-bottom: 0; }
#map-page .breadcrumb .label > strong { text-transform: capitalize; }

.map-card .segment:empty { display: none; }
.map-card .value-list > dt + dd::before { content: ": "; }
.map-card .value-list > dd + dd::before { content: ", "; }
.map-card .value-list > dt::after, .map-card .value-list > dd::after { content: none !important; }
.map-card .value-list > dt { font-weight: bold; }
.map-card .value-list > dd { display: contents !important; margin: 0 !important; }

/* Card modernization */
#map-page > .cards > .card.map-card {
  border-radius: 12px !important;
  box-shadow: 0 2px 12px rgba(0,0,0,0.08) !important;
  transition: box-shadow 0.2s ease, transform 0.2s ease;
  overflow: hidden;
}
#map-page > .cards > .card.map-card:hover {
  box-shadow: 0 4px 20px rgba(0,0,0,0.13) !important;
}
#map-page > .cards { gap: 14px; }

/* Larger touch targets for contact links */
.map-card .ui.secondary.segment .description {
  padding: 4px 0;
  line-height: 1.6;
}
.map-card .ui.secondary.segment .description a {
  display: inline-block;
  min-height: 32px;
  line-height: 32px;
}

/* Category icon menu — horizontal scroll */
#map-nav .mobile-category-scroll {
  display: flex;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
  gap: 0.5em;
  padding: 0.5em 1em;
  scroll-snap-type: x proximity;
  justify-content: center;
  flex-wrap: wrap;
}
#map-nav .mobile-category-scroll::-webkit-scrollbar { display: none; }
#map-nav .mobile-category-scroll > li {
  flex: 0 0 auto;
  scroll-snap-align: start;
  min-width: 72px;
  text-align: center;
  list-style: none;
}

/* Saved button: show text on desktop, icon-only on mobile */
.saved-btn-desktop { display: inline-flex !important; }
.saved-btn-mobile { display: none !important; }

/* Filter drawer */
.filter-drawer {
  max-height: 500px;
  overflow: visible;
  transition: max-height 0.3s ease, opacity 0.25s ease;
  opacity: 1;
}
.filter-drawer.collapsed {
  max-height: 0;
  overflow: hidden;
  opacity: 0;
  pointer-events: none;
}

/* Desktop: filters in a horizontal row */
.filter-drawer .filter-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
}
.filter-drawer .filter-grid > * {
  flex: 1 1 120px;
  min-width: 0;
}
.filter-drawer .filter-grid > .ui.input {
  flex: 0 0 80px;
}
.filter-drawer .filter-grid > .full-width {
  flex: 0 0 auto;
}

/* Panel header — hidden on desktop */
.mobile-card-panel .drag-handle { display: none; }
.mobile-card-panel .panel-header { display: none; }

@media only screen and (max-width:991px){
  .fixed.sticky { position: absolute !important; }
}
@media only screen and (max-width: 767px) {
  #app > header > nav.menu { min-height: 0; }
  #app > header > nav.menu > .item.mac-logo { display: none; }

  /* Lock viewport when map is active — class set by React, no :has() needed */
  #app.map-active {
    overflow: hidden !important;
    height: 100vh;
    height: 100dvh;
  }

  /* Map nav: full bleed, no extra margin */
  #map-nav.ui.segment {
    margin-left: 0 !important;
    margin-right: 0 !important;
    width: 100% !important;
    border-radius: 0 !important;
    flex-shrink: 0;
  }

  /* Map page: full bleed, fill remaining height */
  #map-page.ui.container {
    width: 100% !important;
    max-width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    padding-left: 0;
    padding-right: 0;
  }
  #map-page {
    display: flex !important;
    flex-direction: column;
    position: relative;
    flex: 1 1 0% !important;
    min-height: 0;
    gap: 0;
    overflow: hidden;
  }
  #map-page > .map-right-col {
    flex: 1 1 0%;
    position: relative !important;
    top: 0 !important;
    z-index: 0;
    width: 100%;
    min-height: 0;
    overflow: hidden;
  }
  #map-page > .map-right-col > .leaflet-container {
    height: 100% !important;
    width: 100% !important;
  }
  /* Hide sponsor bar on mobile — but NOT the map (which is also a .ui.segment) */
  #map-page > .map-right-col > .ui.segment:not(.leaflet-container) { display: none; }

  #map-page > .cards {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 2;
    max-height: 35vh;
    background: #fff;
    border-radius: 16px 16px 0 0;
    box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
    overflow-y: auto;
    overscroll-behavior: contain;
    transition: max-height 0.35s ease;
    padding: 0 8px;
    padding-bottom: env(safe-area-inset-bottom, 0px);
  }
  #map-page > .cards.expanded {
    max-height: 80vh;
  }
  .mobile-card-panel .drag-handle {
    display: block;
    width: 36px;
    height: 4px;
    border-radius: 2px;
    background: #ccc;
    margin: 8px auto 4px;
    cursor: pointer;
  }
  .mobile-card-panel .panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 4px 12px 8px;
    font-size: .85em;
    color: #666;
    cursor: pointer;
    user-select: none;
    border-bottom: 1px solid #eee;
    margin-bottom: 8px;
  }

  /* Card active/pressed feedback */
  #map-page > .cards > .card.map-card:active {
    transform: scale(0.98);
  }

  /* Mobile: icon-only saved button */
  .saved-btn-desktop { display: none !important; }
  .saved-btn-mobile { display: inline-flex !important; }

  /* Category icons: single scrollable row */
  #map-nav .mobile-category-scroll {
    flex-wrap: nowrap;
    justify-content: flex-start;
  }

  /* Bigger tap targets on mobile */
  .map-card .ui.secondary.segment .description a {
    min-height: 44px;
    line-height: 44px;
    padding: 0 4px;
  }

  /* Disable scroll snap on #app — the card panel handles its own scroll */
  #app { scroll-snap-type: none; }

  /* Filter drawer 2-col grid on mobile */
  .filter-drawer .filter-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }
  .filter-drawer .filter-grid .full-width { grid-column: 1 / -1; }

  /* Embed: hide filter items by default, show filter toggle */
  .embed-filter-items { display: none !important; }
  .embed-filter-items[style*="flex"] { display: flex !important; }
  .embed-filter-toggle { display: inline-flex !important; }

  /* Embed: stack cards and map on small screens */
  .embed-content { grid-template-columns: 1fr !important; grid-template-rows: 1fr 1fr; }
  .embed-cards-col { order: 2; }
  .embed-map-col { order: 1; }
}

/* Embed: hide filter toggle on wide screens */
@media only screen and (min-width: 768px) {
  .embed-filter-toggle { display: none !important; }
}